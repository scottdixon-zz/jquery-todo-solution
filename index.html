<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Todo List</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">
  </head>
  <body class="has-text-centered">
    <progress class="progress is-primary" value="0" max="100">0</progress>
    <nav class="level">
      <div class="level-item">
        <div>
          <div class="heading">To Do</div>
          <h1 class="title is-1">0</h1>
        </div>
      </div>
    </nav>

    <form>
      <input type="text" class="input is-large is-primary has-text-centered" placeholder="add a todo!" value="">
    </form>

    <br>

    <div id="tasks"></div>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>

    // Wait for the page to be ready before running our JS
    $(document).ready(() => {
      // Load the tasks from local storage if they exist
      const tasks = JSON.parse(localStorage.getItem('tasks')) || [];

      // Listen for form submission
      $('form').submit((event) => {
        // Prevent the browser from handling the form
        event.preventDefault();

        // Add the task to our array and update local storage!
        tasks.push({ item: $('form input').val(), completed: false });
        saveTasks();
        renderTasks();

        // Set the input value back to empty after we add a task
        $('form input').val('');
      });

      // On task click
      $('#tasks').on('click', '.notification', function () {
        // Toggle completed true/false
        const id = $(this).data('id');
        tasks[id].completed = !tasks[id].completed

        renderTasks();
        saveTasks();
      });

      addTask = (index) => {
        const task = tasks[index];
        // Create a task and add it to #tasks
        $('#tasks').prepend($(`<div class="notification ${task.completed ? 'is-primary' : ''}" data-id="${index}">${task.item}</div>`));

        // Update our h1 with the total number of tasks
        $('h1').text($('#tasks div').length);
      }

      // Update progress bar
      updateProgress = () => {
        const totalTasks = $('#tasks div').length;
        const completedTasks = $('#tasks div.notification.is-primary').length;
        $('progress').val((completedTasks/totalTasks) * 100);
      }

      // Refresh tasks
      renderTasks = () => {
        $('#tasks').html('');
        for (const index in tasks) {
          addTask(index)
        }
        updateProgress()
      }

      saveTasks = () => {
        localStorage.setItem('tasks', JSON.stringify(tasks));
      }

      // Load tasks!
      renderTasks()

    });

    </script>

  </body>
</html>
